# ShiftCrafter Part 2 — 1か月・二交代（CSV/ICS 出力）

**目的**：二交代（**日勤/夜勤**）の**1か月**シフトを、**ブラウザだけ**で自動割当し、**CSV**と**ICS**で配布します。  
データは**外部送信しません**。教育・業務補助目的のクライアントサイドWebアプリです。

- 連載：Part 3（三交代）→Part 4（早出・遅出）→Part 5（時短勤務）→Part 6（看護助手など混合）…と拡張予定
- デモ（GitHub Pages）：https://rehab-datascience.github.io/shiftcrafter-monthly-2shift/index.html
- リポジトリ：https://github.com/rehab-datascience/shiftcrafter-monthly-2shift

---

## 使い方（最短3ステップ）
1. 画面で **対象月（YYYY-MM）** と **必要人数（全日共通）** を設定  
2. **職員リスト（1行1名）** と **休み希望（任意）** を貼り付け  
3. **［シフト自動作成］ → ［CSVダウンロード］または［ICSダウンロード（全体）］**

> サンプル：`/samples/staff_sample.txt`、`/samples/requests_sample.txt`（本README末尾にも掲載）

---

## 入力仕様
- **対象月**：`YYYY-MM`（例：`2025-11`）

- **必要人数**（MVP）：  
  - 日勤：全日共通の人数  
  - 夜勤：全日共通の人数

- **職員リスト**：1行1名（例）
田中
鈴木
佐藤

- **休み希望**（任意）：1行1件  
YYYY-MM-DD<空白>氏名
例）2025-11-03 田中

---

## 割当ロジック（MVP）
- **Night → Day（翌日）禁止**  
- **週あたり夜勤上限**（各職員）  
- **月あたり夜勤上限**（任意・空欄なら無制限）  
- **休み希望の尊重**  
- 優先順位：**夜勤回数（少） → 週内夜勤回数（少） → 総割当（少） → 名前（安定化）**  
- **公平性の最適化**（偏り最小化）は**次段**で対応予定

---

## 出力
### 1) CSV（Wide形式・BOM付）
- ファイル名：`schedule_monthly.csv`  
- 文字コード：UTF-8（BOM付）／改行：LF  
- 列：
- `date, dow, need_day, need_night, day_staff_1..K, night_staff_1..K`
- 例（抜粋）：
date,dow,need_day,need_night,day_staff_1,day_staff_2,night_staff_1
2025-11-01,Sat,2,1,田中,鈴木,佐藤

### 2) ICS（カレンダー）
- ファイル名：`shift_monthly_all.ics`  
- 形式：iCalendar（`VCALENDAR/VEVENT`）、タイムゾーン：`Asia/Tokyo`  
- 既定の時刻：日勤 **09:00–17:00**／夜勤 **17:00–翌09:00**（`buildICS()`で変更可）  
- **Googleカレンダー取込**：`設定 > インポート` → `shift_monthly_all.ics` を選択  
- **Outlook取込**：`ファイル > 開く/エクスポート > インポート/エクスポート > iCalendar` を選択

---

## 画面内の「検証サマリ」
- スタッフ別 **総割当**／**夜勤回数** を一覧表示  
- **連続夜勤（2連以上）** を簡易検出（注意表示）

> さらに厳密な検証（希望休充足率・週/月上限違反の一覧など）は、次段で**検証CSV**を追加予定

---

## 既知の非対応（MVPの制限）
- 日別で **必要人数が変動**するケース（現状は全日共通）  
- **公平性の最適化**（目的関数による偏り最小化）  
- **per-staff ICS** の一括出力（現状は全体1ファイル）  
- 祝日や特定日ルール（将来、休日CSV読み込みで対応予定）

---

## プライバシーと免責
- 本ツールは**クライアントサイド**で動作し、**外部送信は行いません**。  
- 教育・業務補助を目的とし、**結果の最終判断は利用者**が行ってください。  
- 所属施設の規程・労務基準・個人情報保護方針に従って運用してください。

---

## Issue / 相談
- 🐛 **バグ報告**・✨ **機能要望**・🤝 **カスタム相談** を受け付けています：  

---

## ライセンス
- **MIT License**

---

## 付録：入力サンプル
### `staff_sample.txt`
田中
鈴木
佐藤
高橋
伊藤
渡辺
山本
小林
中村
加藤

### `requests_sample.txt`
2025-11-03 田中
2025-11-03 鈴木
2025-11-08 伊藤
2025-11-10 渡辺
2025-11-15 山本
2025-11-22 佐藤
2025-11-24 高橋
